# Dependabot Configuration for BrepFlow
# Automated dependency updates with security-first approach

version: 2

updates:
  # ═══════════════════════════════════════════════════════════════════════════
  # NPM Dependencies (Root & Monorepo Packages)
  # ═══════════════════════════════════════════════════════════════════════════

  # Root package.json
  - package-ecosystem: 'npm'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '02:00'
      timezone: 'UTC'
    open-pull-requests-limit: 10
    versioning-strategy: 'increase'

    # Security updates
    allow:
      - dependency-type: 'all'

    # Group updates
    groups:
      # Critical security updates (always separate PRs)
      security-critical:
        patterns:
          - '*'
        update-types:
          - 'security'

      # Production dependencies
      production-dependencies:
        dependency-type: 'production'
        update-types:
          - 'minor'
          - 'patch'

      # Development dependencies
      development-dependencies:
        dependency-type: 'development'
        update-types:
          - 'minor'
          - 'patch'

    # Commit message configuration
    commit-message:
      prefix: 'deps'
      prefix-development: 'deps-dev'
      include: 'scope'

    # Labels for PR categorization
    labels:
      - 'dependencies'
      - 'automated'

    # Reviewers (optional - uncomment and configure)
    # reviewers:
    #   - "security-team"

    # Assignees (optional - uncomment and configure)
    # assignees:
    #   - "lead-developer"

    # Ignore specific dependencies (if needed)
    ignore:
      # Example: Ignore major version updates for stable packages
      # - dependency-name: "react"
      #   update-types: ["version-update:semver-major"]

  # Studio app
  - package-ecosystem: 'npm'
    directory: '/apps/studio'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '03:00'
    open-pull-requests-limit: 5
    commit-message:
      prefix: 'deps(studio)'
    labels:
      - 'dependencies'
      - 'studio'
      - 'automated'

  # Marketing app
  - package-ecosystem: 'npm'
    directory: '/apps/marketing'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '03:30'
    open-pull-requests-limit: 5
    commit-message:
      prefix: 'deps(marketing)'
    labels:
      - 'dependencies'
      - 'marketing'
      - 'automated'

  # Engine Core
  - package-ecosystem: 'npm'
    directory: '/packages/engine-core'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '04:00'
    open-pull-requests-limit: 5
    commit-message:
      prefix: 'deps(engine-core)'
    labels:
      - 'dependencies'
      - 'engine-core'
      - 'automated'

  # ═══════════════════════════════════════════════════════════════════════════
  # GitHub Actions
  # ═══════════════════════════════════════════════════════════════════════════

  - package-ecosystem: 'github-actions'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '05:00'
    open-pull-requests-limit: 5
    commit-message:
      prefix: 'ci'
      include: 'scope'
    labels:
      - 'ci/cd'
      - 'github-actions'
      - 'automated'

  # ═══════════════════════════════════════════════════════════════════════════
  # Docker
  # ═══════════════════════════════════════════════════════════════════════════

  - package-ecosystem: 'docker'
    directory: '/'
    schedule:
      interval: 'weekly'
      day: 'monday'
      time: '06:00'
    open-pull-requests-limit: 3
    commit-message:
      prefix: 'docker'
    labels:
      - 'docker'
      - 'infrastructure'
      - 'automated'
# ═══════════════════════════════════════════════════════════════════════════
# Dependabot Configuration Notes
# ═══════════════════════════════════════════════════════════════════════════
#
# Update Strategy:
# - Security updates: Always create separate PRs immediately
# - Production deps: Grouped by minor/patch, weekly on Monday
# - Dev deps: Grouped by minor/patch, weekly on Monday
# - GitHub Actions: Weekly updates for CI/CD security
# - Docker: Weekly base image updates
#
# Security-First Approach:
# 1. Critical security updates bypass grouping (separate PRs)
# 2. All security patches applied immediately
# 3. Weekly schedule ensures regular security hygiene
# 4. Major version updates require manual review
#
# PR Management:
# - Max 10 root dependency PRs
# - Max 5 PRs per package to prevent overwhelming the team
# - Labeled for easy filtering and review
# - Commit messages follow Conventional Commits
#
# Customization:
# - Uncomment reviewers/assignees sections to auto-assign
# - Add to ignore list for packages requiring manual control
# - Adjust schedules if weekly updates are too frequent
#
# Integration with CI/CD:
# - All Dependabot PRs run through security-scan.yml workflow
# - PRs blocked if security vulnerabilities detected
# - Automated testing ensures updates don't break functionality
#
